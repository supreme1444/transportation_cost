# Развертывание FastAPI приложения для расчета стоимости страховки

Это приложение FastAPI предназначено для расчета стоимости страховки на основе тарифов для различных типов грузов. Оно использует асинхронные вызовы и подключается к базе данных PostgreSQL.

## Описание приложения

### Основные компоненты приложения
## Эндпоинты
### 1. Регистрация пользователя
**POST /register**  
Регистрация нового пользователя.
---
### 2. Получение токена доступа
**POST /token**  
Аутентификация пользователя.
---
### 3. Создание реферального кода
**POST /referral-code**  
Создание реферального кода.
---
### 4. Удаление реферального кода
**DELETE /referral-code**  
Удаление реферального кода.
---
### 5. Получение реферального кода по email
**GET /referral-code-by-email/{email}**  
Получение кода по email.
---
### 6. Получение рефералов по ID реферера
**GET /referrals/{referrer_id}**  
Получение рефералов по ID.


3. **Подключение к базе данных**:
   - Используется SQLAlchemy для работы с базой данных и асинхронные сессии для выполнения запросов.
   - Заполнить .env файл с подключением.DATABASE_URL=......
4. 
5. **Docker и Docker Compose**:
   - Приложение упаковано в Docker-контейнер, что упрощает его развертывание.
6. **Запустите контейнер базы данных:**:
     - Запустите контейнер базы данных docker-compose up -d
7. **Запуск приложения**:
     - Создать файл .env DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/postgres
     - Сделайть миграции alembic revision --autogenerate -m "базовая миграция 1"
     - Применить миграции alembic upgrade head 
     - Запуск сервера uvicorn main:app --reload  
8.  Войти по адрессу http://127.0.0.1:8000/docs#/ и протестировать эндпоинт /calculate-insurance/ с помощью Postman или cURL, отправив POST-запрос с JSON-данными:
    **Пример**
{
  "date_request": "2022-03-10",
  "cargo_type": "Clothing",
  "declared_value": 10000.0
}
9. **Использование Kafka**:
   - Для логирования и обработки событий используется Apache Kafka. Приложение отправляет логи и события в Kafka, что позволяет отслеживать действия и производить дальнейшую обработку данных.
